import{d as M,z as P,c as R,b as l,w as n,h as i,x as j,r as u,o as k,a as q,f as F,g as d,t as G,j as U,i as H,E as g,D,p as J,_ as O}from"./index-DGdM1tdo.js";const Q={class:"drugs"},W={class:"toolbar"},X=M({__name:"Drugs",setup(Y){const c=i(""),y=i(1),b=i(10),C=i(0),x=i([]),f=i(!1),v=i(null),V=i(!1),o=H({name:"",spec:"",unit:"",usageInstruction:""});function $(t){return{ACTIVE:"启用",DISABLED:"禁用"}[t]??t}async function p(){const t=new URLSearchParams;t.set("page",String(y.value-1)),t.set("size",String(b.value)),c.value&&t.set("keyword",c.value);const e=await j(`/admin/drugs?${t}`);x.value=(e==null?void 0:e.content)??[],C.value=(e==null?void 0:e.totalElements)??0}function I(t){v.value=t,o.name=(t==null?void 0:t.name)??"",o.spec=(t==null?void 0:t.spec)??"",o.unit=(t==null?void 0:t.unit)??"",o.usageInstruction=(t==null?void 0:t.usageInstruction)??"",f.value=!0}async function B(){var t;if(!o.name.trim()){g.warning("请输入药品名称");return}V.value=!0;try{(t=v.value)!=null&&t.id?await D(`/admin/drugs/${v.value.id}`,o):await J("/admin/drugs",o),g.success("保存成功"),f.value=!1,p()}catch(e){g.error((e==null?void 0:e.message)??"保存失败")}finally{V.value=!1}}async function E(t,e){try{await D(`/admin/drugs/${t.id}`,{...t,status:e}),g.success("操作成功"),p()}catch(s){g.error((s==null?void 0:s.message)??"操作失败")}}return P(p),(t,e)=>{var S;const s=u("el-input"),r=u("el-button"),m=u("el-table-column"),A=u("el-table"),T=u("el-pagination"),L=u("el-card"),_=u("el-form-item"),N=u("el-form"),K=u("el-dialog");return k(),R("div",Q,[l(L,null,{default:n(()=>[q("div",W,[l(s,{modelValue:c.value,"onUpdate:modelValue":e[0]||(e[0]=a=>c.value=a),placeholder:"搜索药品名称",clearable:"",style:{width:"200px"},onKeyup:F(p,["enter"])},null,8,["modelValue"]),l(r,{type:"primary",onClick:p},{default:n(()=>[...e[10]||(e[10]=[d("查询",-1)])]),_:1}),l(r,{type:"success",onClick:e[1]||(e[1]=a=>I(null))},{default:n(()=>[...e[11]||(e[11]=[d("新增药品",-1)])]),_:1})]),l(A,{data:x.value,stripe:"",style:{"margin-top":"16px"}},{default:n(()=>[l(m,{prop:"name",label:"名称",width:"180"}),l(m,{prop:"spec",label:"规格",width:"140"}),l(m,{prop:"unit",label:"单位",width:"80"}),l(m,{prop:"usageInstruction",label:"用法","show-overflow-tooltip":""}),l(m,{prop:"status",label:"状态",width:"90"},{default:n(({row:a})=>[d(G($(a.status)),1)]),_:1}),l(m,{label:"操作",width:"140",fixed:"right"},{default:n(({row:a})=>[l(r,{type:"primary",link:"",onClick:z=>I(a)},{default:n(()=>[...e[12]||(e[12]=[d("编辑",-1)])]),_:1},8,["onClick"]),a.status==="ACTIVE"?(k(),U(r,{key:0,type:"danger",link:"",onClick:z=>E(a,"DISABLED")},{default:n(()=>[...e[13]||(e[13]=[d("禁用",-1)])]),_:1},8,["onClick"])):(k(),U(r,{key:1,type:"success",link:"",onClick:z=>E(a,"ACTIVE")},{default:n(()=>[...e[14]||(e[14]=[d("启用",-1)])]),_:1},8,["onClick"]))]),_:1})]),_:1},8,["data"]),l(T,{"current-page":y.value,"onUpdate:currentPage":e[2]||(e[2]=a=>y.value=a),"page-size":b.value,"onUpdate:pageSize":e[3]||(e[3]=a=>b.value=a),total:C.value,"page-sizes":[10,20,50],layout:"total, sizes, prev, pager, next",style:{"margin-top":"16px"},onCurrentChange:p,onSizeChange:p},null,8,["current-page","page-size","total"])]),_:1}),l(K,{modelValue:f.value,"onUpdate:modelValue":e[9]||(e[9]=a=>f.value=a),title:(S=v.value)!=null&&S.id?"编辑药品":"新增药品",width:"500","destroy-on-close":""},{footer:n(()=>[l(r,{onClick:e[8]||(e[8]=a=>f.value=!1)},{default:n(()=>[...e[15]||(e[15]=[d("取消",-1)])]),_:1}),l(r,{type:"primary",loading:V.value,onClick:B},{default:n(()=>[...e[16]||(e[16]=[d("确定",-1)])]),_:1},8,["loading"])]),default:n(()=>[l(N,{ref:"formRef",model:o,"label-width":"100px"},{default:n(()=>[l(_,{label:"名称",required:""},{default:n(()=>[l(s,{modelValue:o.name,"onUpdate:modelValue":e[4]||(e[4]=a=>o.name=a),placeholder:"药品名称"},null,8,["modelValue"])]),_:1}),l(_,{label:"规格"},{default:n(()=>[l(s,{modelValue:o.spec,"onUpdate:modelValue":e[5]||(e[5]=a=>o.spec=a),placeholder:"如 0.5g*24粒"},null,8,["modelValue"])]),_:1}),l(_,{label:"单位"},{default:n(()=>[l(s,{modelValue:o.unit,"onUpdate:modelValue":e[6]||(e[6]=a=>o.unit=a),placeholder:"如 盒、瓶"},null,8,["modelValue"])]),_:1}),l(_,{label:"用法"},{default:n(()=>[l(s,{modelValue:o.usageInstruction,"onUpdate:modelValue":e[7]||(e[7]=a=>o.usageInstruction=a),type:"textarea",rows:2,placeholder:"用法用量"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),w=O(X,[["__scopeId","data-v-b6b63b7d"]]);export{w as default};
