<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.healthcare.mapper.DoctorProfileMapper">

    <resultMap id="BaseResultMap" type="com.healthcare.entity.DoctorProfile">
        <id column="id" property="id"/>
        <result column="user_id" property="userId"/>
        <result column="real_name" property="realName"/>
        <result column="hospital" property="hospital"/>
        <result column="department" property="department"/>
        <result column="title" property="title"/>
        <result column="license_no" property="licenseNo"/>
        <result column="audit_status" property="auditStatus" typeHandler="org.apache.ibatis.type.EnumTypeHandler"/>
        <result column="created_at" property="createdAt"/>
        <result column="updated_at" property="updatedAt"/>
    </resultMap>

    <insert id="insert" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO doctor_profile (user_id, real_name, hospital, department, title, license_no, audit_status, created_at, updated_at)
        VALUES (#{userId}, #{realName}, #{hospital}, #{department}, #{title}, #{licenseNo}, #{auditStatus}, NOW(), NOW())
    </insert>

    <update id="update">
        UPDATE doctor_profile
        SET real_name = #{realName}, hospital = #{hospital}, department = #{department}, title = #{title},
            license_no = #{licenseNo}, audit_status = #{auditStatus}, updated_at = NOW()
        WHERE id = #{id}
    </update>

    <update id="updateAuditStatus">
        UPDATE doctor_profile SET audit_status = #{auditStatus}, updated_at = NOW() WHERE id = #{id}
    </update>

    <select id="selectById" resultMap="BaseResultMap">
        SELECT * FROM doctor_profile WHERE id = #{id}
    </select>

    <select id="selectByUserId" resultMap="BaseResultMap">
        SELECT * FROM doctor_profile WHERE user_id = #{userId}
    </select>

    <select id="selectAll" resultMap="BaseResultMap">
        SELECT * FROM doctor_profile ORDER BY created_at DESC
    </select>

    <select id="count" resultType="long">
        SELECT COUNT(*) FROM doctor_profile
    </select>
</mapper>
