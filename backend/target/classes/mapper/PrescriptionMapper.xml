<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.healthcare.mapper.PrescriptionMapper">

    <resultMap id="BaseResultMap" type="com.healthcare.entity.Prescription">
        <id column="id" property="id"/>
        <result column="session_id" property="sessionId"/>
        <result column="patient_id" property="patientId"/>
        <result column="doctor_id" property="doctorId"/>
        <result column="diagnosis" property="diagnosis"/>
        <result column="created_at" property="createdAt"/>
    </resultMap>

    <insert id="insert" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO prescription (session_id, patient_id, doctor_id, diagnosis, created_at)
        VALUES (#{sessionId}, #{patientId}, #{doctorId}, #{diagnosis}, NOW())
    </insert>

    <select id="selectById" resultMap="BaseResultMap">
        SELECT * FROM prescription WHERE id = #{id}
    </select>

    <select id="selectByPatientIdOrderByCreatedAtDesc" resultMap="BaseResultMap">
        SELECT * FROM prescription WHERE patient_id = #{patientId} ORDER BY created_at DESC
    </select>

    <select id="selectByDoctorIdOrderByCreatedAtDesc" resultMap="BaseResultMap">
        SELECT * FROM prescription WHERE doctor_id = #{doctorId} ORDER BY created_at DESC
    </select>

    <select id="selectBySessionId" resultMap="BaseResultMap">
        SELECT * FROM prescription WHERE session_id = #{sessionId}
    </select>
</mapper>
